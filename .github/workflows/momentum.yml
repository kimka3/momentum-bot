name: ëª¨ë©˜í…€ ë¶„ì„ ìë™ ì‹¤í–‰

# ì–¸ì œ ì‹¤í–‰í• ì§€ ì„¤ì •
on:
  schedule:
    # í¬ë¡  í‘œí˜„ì‹: ë¶„ ì‹œ ì¼ ì›” ìš”ì¼ (UTC ê¸°ì¤€)
    # ë§¤ì¼ í•œêµ­ì‹œê°„ ì˜¤ì „ 9ì‹œ = UTC 0ì‹œ
    - cron: '0 0 * * *'
    
    # ë‹¤ë¥¸ ìŠ¤ì¼€ì¤„ ì˜ˆì‹œ:
    # - cron: '0 0 * * 1'     # ë§¤ì£¼ ì›”ìš”ì¼ ì˜¤ì „ 9ì‹œ (í•œêµ­ì‹œê°„)
    # - cron: '0 0 1 * *'     # ë§¤ì›” 1ì¼ ì˜¤ì „ 9ì‹œ
    # - cron: '0 0,12 * * *'  # ë§¤ì¼ ì˜¤ì „9ì‹œ, ì˜¤í›„9ì‹œ
  
  # ìˆ˜ë™ ì‹¤í–‰ ê°€ëŠ¥í•˜ë„ë¡ ì„¤ì •
  workflow_dispatch:

# í™˜ê²½ë³€ìˆ˜ ì„¤ì • (ì „ì—­)
env:
  PYTHONPATH: ${{ github.workspace }}
  TZ: Asia/Seoul

jobs:
  momentum-analysis:
    name: ëª¨ë©˜í…€ ë¶„ì„ ì‹¤í–‰
    runs-on: ubuntu-latest
    
    steps:
    # 1. ì½”ë“œ ì²´í¬ì•„ì›ƒ
    - name: ğŸ“¥ ì½”ë“œ ê°€ì ¸ì˜¤ê¸°
      uses: actions/checkout@v4
    
    # 2. Python í™˜ê²½ ì„¤ì •
    - name: ğŸ Python í™˜ê²½ ì„¤ì •
      uses: actions/setup-python@v4
      with:
        python-version: '3.10'
        cache: 'pip'
    
    # 3. ì˜ì¡´ì„± ìºì‹œ ì„¤ì • (ì„ íƒì‚¬í•­, ì†ë„ í–¥ìƒ)
    - name: ğŸ“¦ ì˜ì¡´ì„± ìºì‹œ
      uses: actions/cache@v3
      with:
        path: ~/.cache/pip
        key: ${{ runner.os }}-pip-${{ hashFiles('**/requirements.txt') }}
        restore-keys: |
          ${{ runner.os }}-pip-
    
    # 4. ë¼ì´ë¸ŒëŸ¬ë¦¬ ì„¤ì¹˜
    - name: ğŸ“š ë¼ì´ë¸ŒëŸ¬ë¦¬ ì„¤ì¹˜
      run: |
        python -m pip install --upgrade pip
        pip install -r requirements.txt
    
    # 5. ì‹¤í–‰ ê¶Œí•œ ë¶€ì—¬ (í•„ìš”ì‹œ)
    - name: ğŸ” ì‹¤í–‰ ê¶Œí•œ ì„¤ì •
      run: chmod +x main.py
    
    # 6. ëª¨ë©˜í…€ ë¶„ì„ ì‹¤í–‰
    - name: ğŸ“Š ëª¨ë©˜í…€ ë¶„ì„ ì‹¤í–‰
      env:
        TELEGRAM_TOKEN: ${{ secrets.TELEGRAM_TOKEN }}
        CHAT_ID: ${{ secrets.CHAT_ID }}
      run: |
        python main.py
    
    # 7. ë¡œê·¸ ì—…ë¡œë“œ (ì‹¤íŒ¨ì‹œì—ë„ ì—…ë¡œë“œ)
    - name: ğŸ“‹ ë¡œê·¸ íŒŒì¼ ì—…ë¡œë“œ
      uses: actions/upload-artifact@v3
      if: always()
      with:
        name: analysis-logs-${{ github.run_number }}
        path: |
          momentum_analysis.log
          *.log
        retention-days: 30
    
    # 8. ì‹¤íŒ¨ì‹œ ì•Œë¦¼ (ì„ íƒì‚¬í•­)
    - name: ğŸš¨ ì‹¤íŒ¨ ì•Œë¦¼
      if: failure()
      env:
        TELEGRAM_TOKEN: ${{ secrets.TELEGRAM_TOKEN }}
        CHAT_ID: ${{ secrets.CHAT_ID }}
      run: |
        curl -s -X POST https://api.telegram.org/bot${TELEGRAM_TOKEN}/sendMessage \
          -d chat_id=${CHAT_ID} \
          -d text="âŒ GitHub Actions ì‹¤í–‰ ì‹¤íŒ¨: ${{ github.repository }} - ${{ github.run_id }}"
